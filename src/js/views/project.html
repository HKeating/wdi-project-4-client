<div ng-controller="LogCtrl as log">


<h1>{{project.project.title}}</h1>
<!-- <p>{{ project.project }}</p> -->

<div class="lineContainer">
  <div class="line"></div>
</div>

<div class="row">
  <div class="taskPanel col-sm-6">
    <h3 id="dayLabel">Day {{ selectedDay }}</h3>
    <div class="task col-sm-6" ng-repeat="task in project.project.tasks track by $index" ng-if="selectedDay>=task.start_day && selectedDay<=task.due_day && task.completed === false && task.blocked === false">

      <div id="{{task.id}}" class="taskCard" data-drag="true" data-jqyoui-options="{revert: 'invalid'}" jqyoui-draggable="{animate:true, onStart:'selectTask(task)', onDrag:'onDrag(task)', onStop:'hideDropZone'}">
        <div class="taskColorTag col-sm-2" ng-click="project.selectTaskToEdit(task.id)">
        </div>
        <!-- <div class="taskContent col-sm-10">
        <div class="col-sm-12">
        <p>{{task.description}}</p>
      </div> -->
      <div class="taskContent col-sm-10">
        <div class="col-sm-12">
          <p>{{task.description}}</p>
          <!-- <button ng-click="project.selectTaskToEdit(task.id)" type="button" name="button">?</button> -->
        </div>
        <div class="row">
          <div class="col-sm-6 taskTags">
            <p>Some tags</p>
          </div>
          <div class="col-sm-6 taskUserContainer">
            <div ng-repeat="user in task.users" class="col-sm-3">
              <img class="taskUserImg" ng-src="{{ user.image }}" alt="">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="addTask col-sm-6">
    <div class="addTaskCard">
      <form ng-submit="project.createTask()">
        <div class="form-group">
          <label for="description">Description</label>
          <input type="text" ng-model="project.newTask.description" name="description" value="">
        </div>
        <div class="form-group">
          <label for="due_Day">Due Day</label>
          <input type="text" onkeypress="return event.charCode >= 48 && event.charCode <= 57" ng-model="project.newTask.due_day" name="duration" value="">
        </div>
        <div class="form-group">
          <input type="submit" name="submit" value="Add Task">
        </div>
      </form>


    </div>
  </div>
</div>

<div class="controlPanel col-sm-5">
  <div class="dropZone" ng-show="project.showDropZone">
    <div id="completedBox" class="completedBox row" ng-model="done" data-drop="true" data-jqyoui-options jqyoui-droppable="{multiple:true, animate:true, onDrop:'completeTask', onOver:'onOverCompletedBox', onOut:'onOutCompletedBox'}">
      <h2>DONE</h2>
    </div>

    <div id="blockedBox" class="blockedBox row" ng-model="block" data-drop="true" data-jqyoui-options jqyoui-droppable="{multiple:true, animate:true, onDrop:'taskBlocked', onOver:'onOverBlockedBox', onOut:'onOutBlockedBox'}">
      <h2>BLOCKED</h2>
    </div>

    <div id="destroyBox" class="destroyBox row" ng-model="destroy" data-drop="true" data-jqyoui-options jqyoui-droppable="{multiple:true, animate:true, onDrop:'giveUpTask', onOver:'onOverDestroyBox', onOut:'onOutDestroyBox'}">
      <h2>DESTROY</h2>
    </div>
  </div>
  <div class="stats row" ng-show="project.statsShow">
    <h1>{{ project.project.title }} STATS</h1>
    <h2>Tasks</h2>
      <ul>
        <li ng-if="project.totalTasks">Total Tasks Created: {{ project.totalTasks }}</li>
        <li ng-if="project.totalTasksCompleted">Tasks Completed: {{ project.totalTasksCompleted }}</li>
        <li ng-if="project.totalTasksDeleted">Tasks Deleted: {{ project.totalTasksDeleted }}</li>
      </ul>
    <h2>Active Users</h2>
      <ul>
        <li ng-repeat="user in project.activeUsers">
          <p>{{ user.username }}</p>
          <p ng-if="user.tasksCompleted">Tasks completed: {{ user.tasksCompleted }}</p>
          <p ng-if="user.tasksDeleted">Tasks deleted: {{ user.tasksDeleted }}</p>
        </li>
      </ul>





  </div>
  <div class="log row" ng-show="project.logShow">
    <h1>LOG</h1>
    <ul>
      <li ng-repeat="day in project.projectDays track by $index" ng-if="project.logDays.includes(day)">
        <h4>Day: {{ day }}</h4>
        <ul>
          <li ng-repeat="log in project.projectLogs" ng-if="log.day === day">
            <p>{{ project.convertDate(log.created_at) }} <span ng-bind-html="log.content"></span></p>
          </li>
        </ul>
      </li>
    </ul>
    <!-- <ul>
      <li ng-repeat="log in project.projectLogs">
        <p>Day {{ log.day }}, {{ project.convertDate(log.created_at) }} <span ng-bind-html="log.content"></span></p>
      </li>
    </ul> -->
  </div>
  <div class="blockedAndCompleted" ng-show="project.tasksShow">
    <div class="taskTabs row">
      <div class="col-sm-6 completedHeader" ng-click="project.showCompleted()">
        <h4>Completed</h4>
      </div>
      <div class="col-sm-6 blockedHeader" ng-click="project.showBlocked()">
        <h4>Blocked</h4>
      </div>
    </div>
    <div class="completed taskPanel row" ng-show="project.completedShow">
      <div class="task col-sm-6" ng-repeat="task in project.project.tasks track by $index" ng-if="task.completed === true">

        <div class="taskCard">
          <div class="taskColorTag col-sm-2" ng-click="project.selectTaskToEdit(task.id)">
          </div>
          <div class="taskContent col-sm-10">
            <div class="col-sm-12">
              <p>{{task.description}}</p>
            </div>
            <div class="row">
              <div class="col-sm-6 taskTags">
                <p>Some tags</p>
              </div>
              <div class="col-sm-6 taskUserContainer">
                <div ng-repeat="user in task.users" class="col-sm-3">
                  <img class="taskUserImg" ng-src="{{ user.image }}" alt="">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="blocked taskPanel row" ng-show="project.blockedShow">
      <div class="task col-sm-6" ng-repeat="task in project.project.tasks track by $index" ng-if="task.blocked === true">

        <div class="taskCard">
          <div class="taskColorTag col-sm-2" ng-click="project.selectTaskToEdit(task.id)">
          </div>
          <div class="taskContent col-sm-10">
            <div class="col-sm-12">
              <p>{{task.description}}</p>
            </div>
            <div class="row">
              <div class="col-sm-6 taskTags">
                <p>Some tags</p>
              </div>
              <div class="col-sm-6 taskUserContainer">
                <div ng-repeat="user in task.users" class="col-sm-3">
                  <img class="taskUserImg" ng-src="{{ user.image }}" alt="">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
  <div class="sideBar col-sm-1">

    <div class="row sideBarOption statsButton" ng-click="project.showStats()">
      <h4>Stats</h4>
    </div>
    <div class="row sideBarOption tasksButton" ng-click="project.showTasks()">
      <h4>Tasks</h4>
    </div>
    <div class="row sideBarOption logButton" ng-click="project.showLog()">
      <h4>Log</h4>
    </div>





  </div>
</div>
<div class="col-sm-6 addMilestone">
  <h3>Add Milestone</h3>
  <form ng-submit="project.createMilestone()">
    <div class="form-group">
      <label for="title">Title</label>
      <input type="text" ng-model="project.newMilestone.title" name="title" value="">
    </div>
    <div class="form-group">
      <label for="day">Complete By Day:</label>
      <input type="text" onkeypress="return event.charCode >= 48 && event.charCode <= 57" ng-model="project.newMilestone.day" name="day" value="">
    </div>
    <div class="form-group">
      <input type="submit" name="submit" value="Add Milestone">
    </div>
    <!-- <h1 ng-click="project.showTaskNewForm = true" class="col-sm-3">+</h1> -->
  </form>
</div>
<div class="col-sm-6 addMilestoneTask">
  <h3>Add Tasks To Milestone</h3>
  <select class="" name="" ng-model="project.milestoneToUpdateId" ng-change="project.selectMilestoneToUpdate(project.milestoneToUpdateId)">
    <option value="" disabled>Select a milestone</option>
    <option ng-repeat="milestone in project.project.milestones" value="{{milestone.id}}">{{ milestone.title }}, day: {{ milestone.day }}</option>
  </select>
  <div ng-show="project.milestoneToUpdate">
    <div class="col-sm-6">
      <h3>{{ project.milestoneToUpdate.title }}</h3>
      <p>Due: day {{ project.milestoneToUpdate.day}}</p>
      <p>Tasks:</p>
      <ul>
        <li class="" ng-repeat="task in project.milestoneToUpdate.tasks">
          <ul>
            <li><strong>{{ task.description }}</strong></li>
            <li>Complete: {{ task.completed }}</li>
            <li>Due: day {{ task.due_day }}</li>
            <li><button type="button" ng-click="project.removeMilestoneTask(project.milestoneToUpdate, task)">Remove</button></li>
          </ul>
        </li>
      </ul>
    </div>
    <div class="col-sm-6">
      <h3>Add tasks:</h3>
      <div class="col-sm-4" ng-repeat="task in project.milestoneToUpdate.availableTasks"  ng-click="project.addMilestoneTask(project.milestoneToUpdate, task)">
        <p><strong>{{task.description}}</strong></p>
      </div>
      <button type="button" ng-click="project.deleteMilestone(project.milestoneToUpdate)">Remove Milestone</button>
    </div>
    <!-- <div class="col-sm-6">
    <h3>Add tasks:</h3>
    <div class="col-sm-4" ng-repeat="task in project.project.tasks" ng-if="project.milestoneToUpdate.day>=task.due_day && !project.checkTask(project.milestoneToUpdate, task)" ng-click="project.addMilestoneTask(project.milestoneToUpdate, task)">
    <p><strong>{{task.description}}</strong></p>
  </div>
</div> -->
</div>
</div>

<div class="col-sm-12 updateTask">


  <div class="" ng-show="project.showTaskEditForm">
    <h3>{{ project.taskToUpdate.description }}</h3>
    <p>Start day: {{ project.taskToUpdate.start_day }}</p>
    <p>Due day: {{ project.taskToUpdate.due_day }}</p>
    <div class="taskUserContainer">
      <h4 ng-show="project.taskToUpdate.users">Assigned users:</h4>
      <div ng-repeat="user in project.taskToUpdate.users" class="col-sm-3">
        <!-- <img class="taskUserImg" ng-src="{{ user.image }}" alt=""> -->
        <p>{{ user.username }}</p>
        <button type="button" ng-click="project.removeTaskUser(project.taskToUpdate, user)" name="button">Remove</button>
      </div>
    </div>
    <div class="taskUserContainer">
      <h4>Assign users:</h4>
      <div ng-repeat="user in project.project.users" class="col-sm-3">
        <!-- <img class="taskUserImg" ng-src="{{ user.image }}" alt=""> -->
        <p>{{ user.username }}</p>
        <button type="button" ng-click="project.addTaskUser(project.taskToUpdate, user)" name="button">Add</button>
      </div>
    </div>
    <div class="form-group">
      <button ng-click="project.hideTaskEditForm()" type="button">Cancel</button>
    </div>
  </div>
</div>
</div>

<h3 id="contributorsLabel">Contributors: </h3>

<div class="" ng-repeat="user in project.project.users">
  <img class="contributorDiv" ng-src="{{ user.image }}" alt="{{ user.username }}">
  <button ng-if="project.userIsAdmin" type="button" name="button" ng-click="project.removeCollaborator(user)">Remove</button>
</div>
<div class="" ng-if="project.userIsAdmin">
  <form>
    <input type="text" ng-model="project.collaboratorSearch" name="" value="">
    <div class="" ng-repeat="user in project.allUsers | filter: { email: project.collaboratorSearch}">
      <p>{{ user.username }}</p>
      <button type="button" ng-click="project.addCollaborator(user)">Add user</button>
    </div>
  </form>
</div>
